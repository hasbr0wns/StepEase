import streamlit as st
import openai

# è®¾ç½®æ ‡é¢˜
st.set_page_config(page_title="StepEase åŠ¨åŠ¨é…±", layout="centered")
st.title("ğŸª„ StepEase Â· æ‹–å»¶æ‹†è§£åŠ©æ‰‹")
st.write("è¾“å…¥ä½ ç°åœ¨åœ¨æ‹–å»¶çš„äº‹ï¼ŒåŠ¨åŠ¨é…±ä¼šå¸®ä½ æ‹†è§£æ­¥éª¤ï¼")

# è¾“å…¥æ¡†
user_input = st.text_area("ğŸ˜´ ä½ ç°åœ¨å¡åœ¨å“ªï¼Ÿ", placeholder="æ¯”å¦‚ï¼šæˆ‘ç°åœ¨èººåœ¨åºŠä¸Šï¼Œæƒ³æ•´ç†æˆ¿é—´", height=150)

# å½“ç‚¹å‡»æŒ‰é’®æ—¶æ‰§è¡Œ
if st.button("ğŸ’¡ åˆ›å»ºè®¡åˆ’"):
    if user_input.strip() == "":
        st.warning("è¯·è¾“å…¥å†…å®¹å“¦")
    else:
        with st.spinner("åŠ¨åŠ¨é…±æ­£åœ¨åŠªåŠ›æ‹†è§£ä¸­..."):
            prompt = f"""
ä½ æ˜¯ä¸€ä¸ªæ¸©æŸ”è€Œç†æ€§çš„è¡ŒåŠ¨å¼•å¯¼åŠ©æ‰‹ï¼Œåå­—å«â€œåŠ¨åŠ¨é…±â€ã€‚
ç”¨æˆ·ä¼šå‘Šè¯‰ä½ ä»–ä»¬ç°åœ¨æ­£åœ¨æ‹–å»¶çš„äº‹æƒ…ï¼Œå¡ä½çš„åŸå› ï¼Œä»¥åŠä»–ä»¬ç›®å‰çš„çŠ¶æ€ï¼ˆæ—¶é—´ã€æƒ…ç»ªã€è¡Œä¸ºç­‰ï¼‰ã€‚
ä½ çš„ä»»åŠ¡æ˜¯æ ¹æ®ç”¨æˆ·çš„è¾“å…¥ï¼Œä¸ºä»–ä»¬æ‹†åˆ†å‡ºä¸€å¥—â€å¾ªåºæ¸è¿›çš„å¾®è¡ŒåŠ¨è®¡åˆ’â€œã€‚

è¯·æ ¹æ®ä¸€ä¸‹åŸåˆ™ç”Ÿæˆå›å¤ï¼š
1.æ‹†åˆ†æˆè‡³å°‘5ä¸ªå°æ­¥éª¤ï¼ˆç”¨emojiå¼€å¤´ï¼Œæ¯æ­¥ä¸€è¡Œï¼‰
2.æ¯æ­¥å†…å®¹è¦å…·ä½“æ¸…æ™°ã€å¯ä»¥ç«‹åˆ»è¡ŒåŠ¨ï¼Œé¿å…ç©ºæ³›æŒ‡ä»¤
3.è¦è€ƒè™‘ç”¨æˆ·è¯´çš„æ—¶é—´ç‚¹ã€æƒ…ç»ªã€åœ°ç‚¹ã€çŠ¶æ€ï¼Œä¸è¦æ— è§†â€œç°åœ¨æ˜¯æ™šä¸Šâ€â€œæˆ‘è¿˜åœ¨åºŠä¸Šâ€ä¹‹ç±»çš„è¯­å¢ƒ
4.å¯ä»¥ç”¨æ¯”å–»ï¼ˆæ¯”å¦‚â€åƒæ¸¸æˆé‡ŒæŒ‰ä¸‹æŠ€èƒ½é”®â€œâ€åƒç»™è§’è‰²å›è¡€â€œï¼‰æ¥é™ä½å¿ƒç†è´Ÿæ‹…
5.æœ€åå¯ä»¥ç»™ä¸€æ®µæ¸©æŸ”åœ°æ¿€åŠ±ï¼ˆä½†ä¸è¦å¼ºç¡¬æˆ–è´¬ä½ç”¨æˆ·ï¼‰

è¯·ç”¨ markdown æ ¼å¼è¾“å‡ºä»¥ä¸‹ä¸¤ä¸ªéƒ¨åˆ†ï¼š
## æ­¥éª¤
- ...
- ...
## é¢å¤–å»ºè®®
- ...

ç”¨æˆ·è¾“å…¥ï¼š{user_input}
"""

            client = openai.OpenAI(
                api_key=st.secrets["OPENAI_API_KEY"]
            )

            response = client.chat.completions.create(
                model="gpt-3.5-turbo",
                messages=[{"role": "user", "content": prompt}],
                temperature=0.8
            )

            output = response.choices[0].message.content
            output = output.replace("ã€‚", "ã€‚<br>")
            st.markdown(output, unsafe_allow_html=True)
        